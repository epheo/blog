# Generated by Butane; do not edit
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 100-vfio
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
        - contents:
            compression: gzip
            source: data:;base64,H4sIAAAAAAAC/7yST08bMRDF7/4UrwsHOND1JlFDU6VSAKnNgfZQpZckihx7lh01tSPbuwgB371y/lBKIpFLuVrvzfzeGx+9y+ds87kKlRBNyW6mYlS6wskp7gXAJcY4K5Ed3y9VrB5z47khn9d2ztZkmH5CrMgKACBdORwrYzyFgM/YaxFAyWIjTgvPlpp3xDPXkPdsSOyOzcNdyOd1yJeaN/KQbyelNAYPD5g8Oa36Ta/aLN3OOBmjr0k8CnEEqXpSvi8wqA07GGpYE8ayI9vTHr79HF4NB7h0fum8iuwsvgwK2cJXvqlwRSVbXr2u3ZfORu8WC/IYF9JQr1BUTnHiqYEqTsUmXV9KKXubxSIV0v8XewUR8iSb9KSarIUpYT9Lc1F0PnSz54dMSS5SJ1kdaEEhZNso8Vn/0SGoyKG8w/D79fUIN97VyxdY3bRNvo7VnayFW6xOG+ddLXewRqsPgdGPC4RbjrqCsgaVsmZBaFj9xftF3tIC66vtoyoOpSrekqp9KFX7iarVQtH5qP8TlT6QSu+jOn9BBfEnAAD//66DaOg9BAAA
          mode: 493
          overwrite: true
          path: /usr/local/bin/vfio-prepare
        - contents:
            compression: ""
            source: data:,vfio-pci
          mode: 420
          overwrite: true
          path: /etc/modules-load.d/vfio-pci.conf
        - contents:
            compression: ""
            source: data:,options%20vfio-pci%20ids%3D8086%3A2723%2C1022%3A149c%0A
          mode: 420
          overwrite: true
          path: /etc/modprobe.d/vfio.conf
    systemd:
      units:
        - contents: |
            [Unit]
            Description=Prepare vfio devices
            After=ignition-firstboot-complete.service
            Before=kubelet.service crio.service

            [Service]
            Type=oneshot
            ExecStart=/usr/local/bin/vfio-prepare

            [Install]
            WantedBy=kubelet.service
          enabled: true
          name: vfioprepare.service
  kernelArguments:
    - amd_iommu=on
    - vga=off
    - rdblaclist=nouveau
    - video=efifb:off
