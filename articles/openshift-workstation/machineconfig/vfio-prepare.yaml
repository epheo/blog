# Generated by Butane; do not edit
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 100-vfio
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
        - contents:
            compression: gzip
            source: data:;base64,H4sIAAAAAAAC/7SRT28TMRDF7/4Uj7SH9lDsTSJSLQpSaCXohQsqlySKHHsWjwh2ZDtbobbfHTm7/GsRtIdcrd8b/97M0Qu5Zi/XOjkh2obDSuesjcPJKW4FwA3mOGswOL7d6uzupY3cUpQ7v2ZvB1i+RnbkBQCQcQHH2tpIKeEN/hoRQMOih8uHZ1vDj+BVaClGtiQej5XpW5LrXZJbwz2e5I9JpY3F3R0WP5Nef6X/xjzdrLgEc9yRuBfiCErXSr2sMNtZDrDUsiHM1ViNljU+fLq6vJrhIsRtiDpz8Hg3q9QQ7/mzwyU17Hn/2qUvgs8xbDYUMa+UpbrS1CxxEqmFrk5F326qlFJ1/7EoC5n+qb2XSLJgi1rpRQeWhtNBmYtq/Goy+P2Qpcn1fvO4/vgW6YazcdDewmlvN4SW9a87fKHoaYNuPQ+sJk+0mjywGo9wPjHqkFaj51sNh6jG5+ZAVuaJVmbRgf+0gvgeAAD///EoQY6mAwAA
          mode: 493
          overwrite: true
          path: /usr/local/bin/vfio-prepare
        - contents:
            compression: ""
            source: data:,vfio-pci
          mode: 420
          overwrite: true
          path: /etc/modules-load.d/vfio-pci.conf
        - contents:
            compression: ""
            source: data:,options%20vfio-pci%20ids%3D8086%3A2723%2C1022%3A149c%0A
          mode: 420
          overwrite: true
          path: /etc/modprobe.d/vfio.conf
    systemd:
      units:
        - contents: |
            [Unit]
            Description=Prepare vfio devices
            After=ignition-firstboot-complete.service
            Before=kubelet.service crio.service

            [Service]
            Type=oneshot
            ExecStart=/usr/local/bin/vfio-prepare

            [Install]
            WantedBy=kubelet.service
          enabled: true
          name: vfioprepare.service
  kernelArguments:
    - amd_iommu=on
    - vga=off
    - rdblaclist=nouveau
    - video=efifb:off
